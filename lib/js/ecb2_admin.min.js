/*! ecb2_admin.js - v1.2 */
$(function(){function e(e){var t=$(e.data("parent")),a=[];e.find(".repeater-field").each(function(e){a.push($(this).val())}),t.val(a.join("||"))}function t(e){var t=e.children("li:not(.placeholder)"),a=$("#"+e.data("cmsms-cb-input")),s="",i=e.data("required-number");i&&t.length!=i?a.val(""):(t.each(function(){s=""==s?$(this).data("cmsms-item-id"):s+","+$(this).data("cmsms-item-id")}),a.val(s))}function a(e){var t=e.data("required-number"),a=e.children().length-1;!t&&a>0||t>0&&a==t?e.children(".placeholder").addClass("hidden"):e.children(".placeholder").removeClass("hidden")}$(".ecb_file_selector_select select").change(function(){var e=$(this).parent().next();e.attr("src",e.data("uploadsurl")+"/"+$(this).val())}),$(".ecb_multiple_select select").change(function(){var e=$(this).val()?$(this).val().join(","):"";$(this).siblings(".ecb_select_input").val(e);var t=$(this).siblings(".ecb_select_summary");if(t.length>0){var a=$(this).children("option:selected").map(function(){return $(this).text()}).get().join(", ");$(this).siblings(".ecb_select_summary").val(a);var s=$(this).siblings(".ecb_select_summary").children(".ecb_select_text");""==a?t.children(".ecb_select_text").html(s.data("empty")):t.children(".ecb_select_text").html(a)}}),$(".ecb_compact .ecb_select_edit").click(function(e){e.preventDefault(),$(this).closest(".ecb_compact").toggleClass("show")}),$(".ecb_repeater").on("change",".repeater-field",function(t){e($($(this).data("repeater")))}),$(".ecb_repeater").on("click",".ecb2-repeater-add",function(t){t.preventDefault();var a=$(this).closest(".repeater-wrapper");a.clone().insertAfter(a).find(".repeater-field").val(""),e($($(this).data("repeater")))}),$(".ecb_repeater").on("click",".ecb2-repeater-remove",function(t){t.preventDefault();var a=$(this).closest(".repeater-wrapper"),s=$($(this).data("repeater"));a.remove(),e(s)}),$("ul.sortable-ecb2-list").each(function(){var e=$(this).closest(".ecb2-cb").find("ul.selected-items");$(this).sortable({connectWith:e,delay:150,revert:300,placeholder:"ui-state-highlight",items:"li:not(.no-sort)",helper:function(e,t){t.hasClass("selected")||t.addClass("selected").siblings().removeClass("selected");var a=t.parent().children(".selected").clone(),s=$("<li/>");return t.data("multidrag",a).siblings(".selected").remove(),s.append(a)},stop:function(e,a){var s=a.item.data("multidrag"),i=$(a.item).parent();a.item.after(s).remove(),t(i)},receive:function(e,t){var s=t.item.data("multidrag");$(this).data("max-number")&&$(this).children().length-1>$(this).data("max-number")?$(t.sender).sortable("cancel"):(a($(this)),$(s).removeClass("selected ui-state-hover").find(".sortable-remove").removeClass("hidden"))}})}),$("ul.selected-items").each(function(){var e=$(this).closest(".ecb2-cb").find("ul.available-items");$(this).sortable({connectWith:e,delay:150,revert:300,placeholder:"ui-state-highlight",stop:function(e,s){var i=$(s.item).closest(".ecb2-cb").find(".selected-items");$(s.item).removeClass("selected"),$(s.item).children(".sortable-remove").addClass("hidden"),t(i),a(i)}})}),$(document).on("click","#selected-items .sortable-remove",function(e){e.preventDefault();var s=$(this).closest("ul.selected-items"),i=$(this).closest(".ecb2-cb").find(".available-items");$(this).addClass("hidden").parent("li").removeClass("no-sort").appendTo(i),t(s),a(s)})});
